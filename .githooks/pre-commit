#!/usr/bin/env sh
set -e

# Workflow Coach (advisory)
#
# Default behavior is non-blocking. To enforce (block) on selected warning IDs:
#   WORKFLOW_COACH_ENFORCE=1 WORKFLOW_COACH_FAIL_ON=dirty-main,spec-mismatch git commit ...
#
if command -v npm >/dev/null 2>&1; then
	if [ "${WORKFLOW_COACH_ENFORCE:-0}" = "1" ]; then
		npm run -s workflow:coach -- --query "pre-commit" --fail-on "${WORKFLOW_COACH_FAIL_ON:-dirty-main,spec-mismatch}"
	else
		npm run -s workflow:coach -- --query "pre-commit" || true
	fi
fi

npx lint-staged
