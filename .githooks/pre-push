#!/usr/bin/env sh
set -e

# Workflow Coach (advisory)
#
# Default behavior is non-blocking. To enforce (block) on selected warning IDs:
#   WORKFLOW_COACH_ENFORCE=1 WORKFLOW_COACH_FAIL_ON=dirty-main,spec-mismatch git push ...
#
if command -v npm >/dev/null 2>&1; then
	if [ "${WORKFLOW_COACH_ENFORCE:-0}" = "1" ]; then
		npm run -s workflow:coach -- --query "pre-push" --fail-on "${WORKFLOW_COACH_FAIL_ON:-dirty-main,spec-mismatch}"
	else
		npm run -s workflow:coach -- --query "pre-push" || true
	fi
fi

# git-lfs hook
command -v git-lfs >/dev/null 2>&1 || {
	echo >&2 "\nThis repository is configured for Git LFS but 'git-lfs' was not found on your path. If you no longer wish to use Git LFS, remove this check from your git hooks (e.g. '.husky/pre-push' or '.githooks/pre-push').\n"
	exit 2
}
git lfs pre-push "$@"
